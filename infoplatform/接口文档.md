# 酒店信息管理平台 - 后端接口文档

## 基础信息

- **基础URL**: `http://localhost:8080/api`
- **数据格式**: JSON
- **认证方式**: JWT Token (Bearer)

## 通用响应格式

```typescript
// 成功响应
{
  "success": true,
  "data": { ... }
}

// 失败响应
{
  "success": false,
  "message": "错误信息"
}
```

---

## 一、认证接口

### 1. 用户登录 - `login`

- **URL**: `POST /PClogin`
- **认证**: 不需要
- **请求体**:
  ```json
  {
    "username": "merchant1",
    "password": "123456"
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "token": "eyJhbGciOiJIUzI1NiIs...",
      "user": {
        "id": "1",
        "username": "merchant1",
        "role": "merchant"
      }
    }
  }
  ```
- **失败响应**:
  ```json
  {
    "success": false,
    "message": "用户名或密码错误"
  }
  ```

### 2. 用户注册 - `register`

- **URL**: `POST /PCregister`
- **认证**: 不需要
- **请求体**:
  ```json
  {
    "username": "newuser",
    "password": "123456",
    "role": "merchant"
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "token": "eyJhbGciOiJIUzI1NiIs...",
      "user": {
        "id": "3",
        "username": "newuser",
        "role": "merchant"
      }
    }
  }
  ```
- **失败响应**:
  ```json
  {
    "success": false,
    "message": "用户名已存在"
  }
  ```

---

## 二、商户端酒店接口

### 3. 获取商户酒店列表 - `getMerchantHotels`

- **URL**: `GET /hotels/getMerchantHotels`
- **认证**: 需要
- **权限**: merchant（只能查看自己的酒店）
- **说明**: 从登录用户的 JWT Token 中解析商户ID，支持分页查询和筛选。当筛选参数不存在时，系统将不进行对应字段的筛选。
- **请求方式**: URL 查询参数（Query Parameters）
  - 示例：`/hotels/getMerchantHotels?page=1&pageSize=10&hotelType=domestic&status=approved&search=万豪`
- **请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | number | 否 | 1 | 当前页码，从 1 开始 |
| pageSize | number | 否 | 10 | 每页数量，可选值：5, 10, 20, 50 |
| hotelType | string | 否 | - | 酒店类型筛选，可选值：domestic（国内）, overseas（海外）, homestay（民宿）, hourly（钟点房） |
| status | string | 否 | - | 状态筛选，可选值：pending, approved, rejected, offline |
| search | string | 否 | - | 搜索关键词，搜索酒店名称 |

- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "list": [
        {
          "id": "1",
          "name": "北京万豪酒店",
          "address": "北京市朝阳区建国路83号",
          "phone": "010-12345678",
          "hotelType": "domestic",
          "status": "approved",
          "firstImage": "https://images.unsplash.com/photo-xxx?w=800"
        },
        {
          "id": "3",
          "name": "广州四季酒店",
          "address": "广州市天河区珠江新城珠江西路5号",
          "phone": "020-12345678",
          "hotelType": "overseas",
          "status": "rejected",
          "firstImage": "",
          "rejectReason": "缺少营业执照副本"
        }
      ],
      "total": 12,
      "page": 1,
      "pageSize": 10,
      "totalPages": 2
    }
  }
  ```

### 4. 获取酒店详情 - `getHotelById`

- **URL**: `GET /merchant/hotels/{id}`
- **认证**: 需要
- **权限**: merchant（只能查看自己的酒店）
- **说明**: GET 请求，酒店 ID 通过 URL 路径参数传递，无需请求体
- **路径参数**:
  - `id`: 酒店 ID
- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "id": "1",
      "name": "北京万豪酒店",
      "address": "北京市朝阳区建国路83号",
      "phone": "010-12345678",
      "description": "酒店描述...",
      "minPrice": 800,
      "maxPrice": 2000,
      "starRating": 5,
      "amenities": ["免费WiFi", "停车场", "餐厅"],
      "hotelType": "domestic",
      "region": "北京",
      "city": "北京",
      "opening_time": "2007",
      "images": ["https://...", "https://..."],
      "roomTypes": [
        {
          "id": "r1",
          "name": "豪华大床房",
          "bedType": 1.8,
          "bedCount": 1,
          "roomSize": 35,
          "capacity": 2,
          "minFloor": 5,
          "maxFloor": 10,
          "image": "https://...",
          "roomCount": 20,
          "price": 888
        }
      ],
      "status": "approved",
      "merchantId": "1",
      "merchantName": "商户1",
      "createdAt": "2024-01-01T00:00:00Z",
      "updatedAt": "2024-01-05T10:00:00Z"
    }
  }
  ```
- **失败响应**:
  ```json
  {
    "success": false,
    "message": "酒店不存在"
  }
  ```

### 5. 创建或更新酒店 - `saveHotel`

- **URL**: `POST /merchant/hotels`
- **认证**: 需要
- **权限**: merchant
- **说明**: 
  - 无 `id` 时为创建，状态默认为 `pending`，商户ID从Token中解析
  - 有 `id` 时为更新，已发布/已拒绝/已下线的酒店编辑后会变为 `pending`
  - 无需传入 `merchantId` 和 `merchantName`，后端从Token解析
- **请求体**:
  ```json
  {
    "id": "1",
    "name": "北京万豪酒店",
    "address": "北京市朝阳区建国路83号",
    "phone": "010-12345678",
    "description": "酒店描述...",
    "minPrice": 800,
    "maxPrice": 2000,
    "starRating": 5,
    "amenities": ["免费WiFi", "停车场", "餐厅"],
    "hotelType": "domestic",
    "region": "北京",
    "city": "北京",
    "opening_time": "2007",
    "images": ["https://..."],
    "roomTypes": [
      {
        "id": "r1",
        "name": "豪华大床房",
        "bedType": 1.8,
        "bedCount": 1,
        "roomSize": 35,
        "capacity": 2,
        "minFloor": 5,
        "maxFloor": 10,
        "image": "https://...",
        "roomCount": 20,
        "price": 888
      }
    ]
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "message": "酒店保存成功"
  }
  ```

### 6. 更新房型房间数量 - `updateRoomCount`

- **URL**: `POST /merchant/hotels/{id}/room-count`
- **认证**: 需要
- **权限**: merchant（只能操作自己的酒店）
- **说明**: 只有 `approved` 状态的酒店才能更新房间数量，不需要审核
- **请求体**:
  ```json
  {
    "roomTypes": [
      {
        "id": "r1",
        "name": "豪华大床房",
        "bedType": 1.8,
        "bedCount": 1,
        "roomSize": 35,
        "capacity": 2,
        "minFloor": 5,
        "maxFloor": 10,
        "image": "https://...",
        "roomCount": 25,
        "price": 888
      }
    ]
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "message": "房间数量更新成功"
  }
  ```
- **失败响应**:
  ```json
  {
    "success": false,
    "message": "只有已发布的酒店才能编辑房间数量"
  }
  ```

### 7. 获取酒店可视化数据 - `getHotelVisualizationData`

- **URL**: `GET /hotels/visualization`
- **认证**: 需要
- **权限**: merchant
- **说明**: 获取当前商户酒店的分布和审核状态数据，用于可视化展示
- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "provinceData": [
        { "name": "北京", "value": 2 },
        { "name": "上海", "value": 1 },
        { "name": "广州", "value": 1 }
      ],
      "auditData": [
        { "name": "审核中", "value": 3 },
        { "name": "已发布", "value": 5 },
        { "name": "已拒绝", "value": 2 },
        { "name": "已下线", "value": 2 }
      ]
    }
  }
  ```

---

## 三、管理员端酒店接口

### 7. 获取所有酒店列表 - `getAllHotels`

- **URL**: `GET /admin/hotels`
- **认证**: 需要
- **权限**: admin
- **说明**: 支持分页查询和筛选。当筛选参数不存在时，系统将不进行对应字段的筛选。
- **请求方式**: URL 查询参数（Query Parameters）
  - 示例：`/admin/hotels?page=1&pageSize=10&hotelType=domestic&status=approved&search=万豪`
- **请求参数**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | number | 否 | 1 | 当前页码，从 1 开始 |
| pageSize | number | 否 | 10 | 每页数量，可选值：5, 10, 20, 50 |
| hotelType | string | 否 | - | 酒店类型筛选，可选值：domestic（国内）, overseas（海外）, homestay（民宿）, hourly（钟点房） |
| status | string | 否 | - | 状态筛选，可选值：pending, approved, rejected, offline |
| search | string | 否 | - | 搜索关键词，搜索酒店名称 |

- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "list": [
        {
          "id": "1",
          "name": "北京万豪酒店",
          "address": "北京市朝阳区建国路83号",
          "phone": "010-12345678",
          "merchantName": "商户1",
          "status": "approved",
          "rejectReason": null,
          "firstImage": "https://images.unsplash.com/photo-xxx?w=800"
        },
        {
          "id": "3",
          "name": "广州四季酒店",
          "address": "广州市天河区珠江新城珠江西路5号",
          "phone": "020-12345678",
          "merchantName": "商户1",
          "status": "rejected",
          "rejectReason": "缺少营业执照副本",
          "firstImage": ""
        }
      ],
      "total": 12,
      "page": 1,
      "pageSize": 10,
      "totalPages": 2
    }
  }
  ```

### 8. 获取酒店详情 - `getHotelById`

- **URL**: `GET /admin/hotels/{id}`
- **认证**: 需要
- **权限**: admin
- **说明**: GET 请求，酒店 ID 通过 URL 路径参数传递，无需请求体
- **路径参数**:
  - `id`: 酒店 ID
- **响应格式**: 同商户端 `getHotelById`

### 9. 审核酒店 - `auditHotel`

- **URL**: `POST /admin/hotels/{id}/audit`
- **认证**: 需要
- **权限**: admin
- **请求体**:
  ```json
  {
    "status": "approved"
  }
  ```
  或
  ```json
  {
    "status": "rejected",
    "rejectReason": "信息不完整，请补充详细信息"
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "message": "审核操作成功"
  }
  ```

### 10. 上下线酒店 - `toggleHotelStatus`

- **URL**: `POST /admin/hotels/{id}/toggle-status`
- **认证**: 需要
- **权限**: admin
- **请求体**:
  ```json
  {
    "status": "offline"
  }
  ```
  或
  ```json
  {
    "status": "approved"
  }
  ```
- **成功响应**:
  ```json
  {
    "success": true,
    "message": "状态更新成功"
  }
  ```

### 11. 获取审核可视化数据 - `getAuditVisualizationData`

- **URL**: `GET /admin/hotels/visualization`
- **认证**: 需要
- **权限**: admin
- **说明**: 获取所有酒店的分布和审核状态数据，用于管理员可视化展示
- **成功响应**:
  ```json
  {
    "success": true,
    "data": {
      "provinceData": [
        { "name": "北京", "value": 2 },
        { "name": "上海", "value": 1 },
        { "name": "广州", "value": 1 },
        { "name": "深圳", "value": 1 },
        { "name": "成都", "value": 1 },
        { "name": "杭州", "value": 1 },
        { "name": "南京", "value": 1 },
        { "name": "西安", "value": 1 },
        { "name": "三亚", "value": 1 },
        { "name": "武汉", "value": 1 },
        { "name": "重庆", "value": 1 },
        { "name": "厦门", "value": 1 }
      ],
      "auditData": [
        { "name": "审核中", "value": 3 },
        { "name": "已发布", "value": 5 },
        { "name": "已拒绝", "value": 2 },
        { "name": "已下线", "value": 2 }
      ]
    }
  }
  ```

---

## 四、数据模型

### PaginationParams 分页请求参数

```typescript
{
  page?: number;      // 当前页码，默认 1
  pageSize?: number;  // 每页数量，默认 10
  hotelType?: 'domestic' | 'overseas' | 'homestay' | 'hourly';  // 酒店类型筛选
  status?: 'pending' | 'approved' | 'rejected' | 'offline';  // 状态筛选
  search?: string;    // 搜索关键词，搜索酒店名称
}
```

### PaginatedResponse<T> 分页响应

```typescript
{
  list: T[];          // 数据列表
  total: number;      // 总记录数
  page: number;       // 当前页码
  pageSize: number;   // 每页数量
  totalPages: number; // 总页数
}
```

### User 用户

```typescript
{
  id: string;           // 用户ID
  username: string;     // 用户名
  role: 'merchant' | 'admin';  // 角色
}
```

### Hotel 酒店

```typescript
{
  id: string;           // 酒店ID
  name: string;         // 酒店名称
  address: string;      // 地址
  phone: string;        // 联系电话
  description: string;  // 酒店描述
  minPrice: number;     // 最低价格
  maxPrice: number;     // 最高价格
  starRating: number;   // 星级评分 1-5
  amenities: string[];  // 设施服务
  hotelType: 'domestic' | 'overseas' | 'homestay' | 'hourly';  // 酒店类型
  region: string;       // 省份/直辖市
  city: string;         // 城市
  opening_time: string; // 开业时间
  images: string[];     // 酒店图片URL数组
  roomTypes: RoomType[]; // 房型列表
  status: 'pending' | 'approved' | 'rejected' | 'offline';  // 状态
  rejectReason?: string; // 拒绝原因
  merchantId: string;   // 商户ID
  merchantName: string; // 商户名称
  createdAt: string;    // 创建时间 ISO8601
  updatedAt: string;    // 更新时间 ISO8601
}
```

### RoomType 房型

```typescript
{
  id: string;           // 房型ID
  name: string;         // 房型名称
  bedType: number;      // 床型（单位：米）
  bedCount: number;     // 床的数量
  roomSize: number;     // 房间大小（单位：平方米）
  capacity: number;     // 可住人数
  minFloor: number;     // 最低楼层
  maxFloor: number;     // 最高楼层
  image: string;        // 房型图片
  roomCount: number;    // 房间数量
  price: number;        // 价格（元/晚）
}
```

### VisualizationData 可视化数据

```typescript
{
  provinceData: Array<{ name: string; value: number }>; // 省份分布数据
  auditData: Array<{ name: string; value: number }>;    // 审核状态数据
}
```

---

## 五、状态说明

| 状态 | 说明 | 可见范围 |
|------|------|----------|
| pending | 审核中 | 商户自己、管理员 |
| approved | 已发布 | 所有人 |
| rejected | 已拒绝 | 商户自己、管理员 |
| offline | 已下线 | 商户自己、管理员 |

---

## 六、接口与 mockApi 函数对照表

| mockApi 函数 | 接口路径 | 方法 | 说明 |
|-------------|---------|------|------|
| login | /PClogin | POST | 用户登录 |
| register | /PCregister | POST | 用户注册 |
| getMerchantHotels | /hotels/getMerchantHotels | GET | 获取商户酒店列表，支持分页参数 `?page=1&pageSize=10` |
| getHotelById | /merchant/hotels/{id} 或 /admin/hotels/{id} | GET | 获取酒店详情 |
| saveHotel | /merchant/hotels | POST | 创建或更新酒店 |
| updateRoomCount | /merchant/hotels/{id}/room-count | POST | 更新房型房间数量 |
| getHotelVisualizationData | /hotels/visualization | GET | 获取酒店可视化数据 |
| getAllHotels | /admin/hotels | GET | 获取所有酒店列表，支持分页参数 `?page=1&pageSize=10` |
| auditHotel | /admin/hotels/{id}/audit | POST | 审核酒店 |
| toggleHotelStatus | /admin/hotels/{id}/toggle-status | POST | 上下线酒店 |
| getAuditVisualizationData | /admin/hotels/visualization | GET | 获取审核可视化数据 |

## 七、分页说明

### 分页参数传递方式

所有列表查询接口都支持分页，**分页参数通过 URL 查询参数（Query Parameters）传递**，而不是请求体。

**Axios 示例**:
```typescript
// 前端使用 axios 传递分页参数
const response = await axios.get('/hotels/getMerchantHotels', {
  params: {
    page: 1,
    pageSize: 10
  }
});
// 实际请求的 URL: /hotels/getMerchantHotels?page=1&pageSize=10
```

**参数说明**:

| 参数名 | 类型 | 必填 | 默认值 | 说明 |
|--------|------|------|--------|------|
| page | number | 否 | 1 | 当前页码，从 1 开始 |
| pageSize | number | 否 | 10 | 每页记录数，可选值：5, 10, 20, 50 |
| hotelType | string | 否 | - | 酒店类型筛选，可选值：domestic（国内）, overseas（海外）, homestay（民宿）, hourly（钟点房） |
| status | string | 否 | - | 状态筛选，可选值：pending, approved, rejected, offline |
| search | string | 否 | - | 搜索关键词，搜索酒店名称 |

### 分页响应格式

```json
{
  "success": true,
  "data": {
    "list": [...],        // 当前页数据列表
    "total": 100,         // 总记录数
    "page": 1,            // 当前页码
    "pageSize": 10,       // 每页数量
    "totalPages": 10      // 总页数
  }
}
```

### 分页示例

**请求**：
```
GET /hotels/getMerchantHotels?page=2&pageSize=5&search=酒店
```

**响应**：
```json
{
  "success": true,
  "data": {
    "list": [
      { "id": "6", "name": "杭州西湖国宾馆", ... },
      { "id": "7", "name": "南京金陵饭店", ... },
      { "id": "8", "name": "西安曲江民宿", ... },
      { "id": "9", "name": "三亚海棠湾度假酒店", ... },
      { "id": "10", "name": "武汉江汉路钟点房", ... }
    ],
    "total": 12,
    "page": 2,
    "pageSize": 5,
    "totalPages": 3
  }
}
```
